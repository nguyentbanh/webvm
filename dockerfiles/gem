# -----------------------------------------------------------------
# 0. Base image: switch from i386/debian:buster to Node-preloaded
# -----------------------------------------------------------------
ARG TARGETPLATFORM          # optional but silences linter
FROM --platform=${TARGETPLATFORM} node:22-bulleye-slim

ARG DEBIAN_FRONTEND=noninteractive

# -----------------------------------------------------------------
# 1. Extra Debian packages you still need
# -----------------------------------------------------------------
RUN apt-get update && apt-get -y upgrade && \
    apt-get -y install --no-install-recommends \
        git vim unzip fakeroot dbus whiptail hexedit \
        patch wamerican ucf manpages file luajit lua50 dialog \
        curl less cowsay netcat-openbsd ruby gcc make && \
    rm -rf /var/lib/apt/lists/*

# -----------------------------------------------------------------
# 2. Gemini CLI (one line: npm is already there!)
# -----------------------------------------------------------------
RUN npm install -g @google/gemini-cli && \
    gemini --version    # optional smoke test

# -----------------------------------------------------------------
# 3.  The rest of your original Dockerfile
# -----------------------------------------------------------------
RUN useradd -m user && echo "user:password" | chpasswd
COPY --chown=user:user ./examples /home/user/examples
RUN chmod -R +x /home/user/examples/lua

WORKDIR /home/user/
ENV HOME="/home/user" TERM="xterm" USER="user" SHELL="/bin/bash" \
    EDITOR="vim" LANG="en_US.UTF-8" LC_ALL="C"

RUN echo 'root:password' | chpasswd
CMD ["/bin/bash"]
