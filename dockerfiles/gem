# 1. Start with the official Node.js image based on Debian Buster.
#    This gives us a working Node.js v20 and npm installation for free.
FROM node:20-buster

ARG DEBIAN_FRONTEND=noninteractive

# 2. Add 32-bit (i386) architecture support and fix the package sources to point to the Debian archive.
#    This is still necessary because the underlying OS is Buster.
RUN dpkg --add-architecture i386 && \
    echo "deb http://archive.debian.org/debian/ buster main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security buster/updates main" >> /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian/ buster-updates main" >> /etc/apt/sources.list

# 3. Update package lists and install all of your required i386 packages.
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    apt-utils:i386 gcc:i386 \
	python3:i386 vim:i386 unzip:i386 ruby:i386 \
	fakeroot:i386 dbus:i386 base:i386 whiptail:i386 hexedit:i386 \
	patch:i386 wamerican:i386 ucf:i386 manpages:i386 \
	file:i386 luajit:i386 make:i386 lua50:i386 dialog:i386 \
	less:i386 cowsay:i386 netcat-openbsd:i386

# 4. Install the Gemini CLI globally. npm is already available from the base image.
RUN npm install -g @google/gemini-cli

# --- The rest of your Dockerfile remains the same ---
RUN useradd -m user && echo "user:password" | chpasswd
COPY --chown=user:user ./examples /home/user/examples
RUN chmod -R +x  /home/user/examples/lua
WORKDIR /home/user/
ENV HOME="/home/user" TERM="xterm" USER="user" SHELL="/bin/bash" EDITOR="vim" LANG="en_US.UTF-8" LC_ALL="C"
RUN echo 'root:password' | chpasswd
CMD [ "/bin/bash" ]
